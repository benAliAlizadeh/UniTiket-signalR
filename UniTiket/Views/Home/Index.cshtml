@model ChatViewModel
@{
    string username = User.Identity.Name;
    bool isAdmin = User.IsInRole("Admin");
    ViewData["Title"] = (isAdmin)? "Admin Page" : "Home Page";

}

<button class="btn btn-outline-info mb-1 mx-2 d-block d-md-none" id="back-to-contacts">back to contacts</button>
@if (isAdmin)
{
    <form class="d-inline-flex mb-1" action="/" method="get">
        <input name="id" id="uname" type="text" class="form-control" placeholder="enter TiketId" style="border-radius:0.25rem 0 0 0.25rem" />
        <button type="submit" class="btn btn-outline-info" id="back-to-contacts" style="border-radius: 0 0.25rem 0.25rem 0 ">get</button>
    </form>
}
else
{
    <div class="d-inline-flex mb-1  mx-2">
        <a href="/Home/CreateTiket" class="btn btn-outline-success" id="back-to-contacts" style="border-radius: 0 0.25rem 0.25rem 0 ">+ Tiket</a>
    </div>
}

<div class="row">
    <div class="col-md-4 d-md-block d-none" id="contacts" style="height:500px">

        <ol class="list-group list-group-numbered" style="overflow: overlay;height:500px">

            @foreach (var item in Model.Tikets)
            {
                <li class="list-group-item d-flex justify-content-between align-items-start">

                    <div class="ms-2 me-auto">
                        <div class="fw-bold"><a href="/@item.TiketId">@item.Title</a></div>
                        @item.LastMessage
                    </div>

                    <span class="badge bg-primary rounded-pill">@item.MessageCount</span>
                </li>
            }


        </ol>

    </div>

    <div class="col-md-8">

        <div class="card" style="height:400px;border-radius: 0.25rem 0.25rem 0 0;" id="messages">
            <div class="card-header">
                @Model.Tiket.Title
            </div>
            <div id="messagesdiv" class="card-body" style="overflow: overlay">

                @foreach (var item in Model.Messages)
                {
                    if (!item.IsAnser)
                    {
                        <div class="row">
                            <div class="col-md-4"></div>
                            <div class="col-md-8">
                                <div class="bdr-callout bdr-callout-primary">
                                    <span class="fw-semibold">@((isAdmin)? Model.Tiket.User.UserName : username)</span>
                                    <p>@item.Text</p>

                                    <span style="font-size:small">@item.CreatedTime</span>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row">
                            <div class="col-md-8">
                                <div class="bd-callout bd-callout-info">
                                    <span class="fw-semibold">Admin</span>
                                    <p>@item.Text</p>

                                    <span style="font-size:small">@item.CreatedTime</span>
                                </div>
                            </div>
                            <div class="col-md-4"></div>
                        </div>
                    }
                }

            </div>

        </div>
        <form id="MessageForm" class="card-footer d-inline-flex" style="width: -webkit-fill-available;">
            <textarea id="messageTextBox" class="form-control" placeholder="message" style="max-height:95px;height:95px;border-radius:0 0 0 0.25rem"></textarea>
            <input type="hidden" value="@ViewBag.tiketId" />
            <input type="hidden" value="@((isAdmin)? 1 : 0)" />

            <button type="submit" class="btn btn-outline-success" style="border-radius: 0 0 0.25rem 0 ">send</button>
        </form>
    </div>

</div>

@section Scripts{
    <script>
        $("#back-to-contacts").on('click', () => {
            $("#contacts").removeClass('d-none');
            $("#back-to-contacts").addClass('d-none');
            $("#messages").addClass('d-none');
        })
    </script>
    <script src="~/js/chat.js"></script>

}